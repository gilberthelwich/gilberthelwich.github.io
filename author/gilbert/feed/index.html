<?xml version="1.0" encoding="UTF-8"?><rss version="2.0"
	xmlns:content="http://purl.org/rss/1.0/modules/content/"
	xmlns:wfw="http://wellformedweb.org/CommentAPI/"
	xmlns:dc="http://purl.org/dc/elements/1.1/"
	xmlns:atom="http://www.w3.org/2005/Atom"
	xmlns:sy="http://purl.org/rss/1.0/modules/syndication/"
	xmlns:slash="http://purl.org/rss/1.0/modules/slash/"
	>

<channel>
	<title>Gilbert</title>
	<atom:link href="/author/gilbert/feed/" rel="self" type="application/rss+xml" />
	<link></link>
	<description>Blog o tematyce Admin/DevOps</description>
	<lastBuildDate>Mon, 14 Oct 2024 17:47:36 +0000</lastBuildDate>
	<language>pl-PL</language>
	<sy:updatePeriod>
	hourly	</sy:updatePeriod>
	<sy:updateFrequency>
	1	</sy:updateFrequency>
	<generator>https://wordpress.org/?v=6.6.2</generator>

<image>
	<url>/wp-content/uploads/2024/09/cd73ea7f-d527-4818-8b78-8763318bac57-150x150.png</url>
	<title>Gilbert</title>
	<link></link>
	<width>32</width>
	<height>32</height>
</image> 
	<item>
		<title>Debugowanie poÅ‚Ä…czeÅ„ sieciowych na Linuxie</title>
		<link>/2024/10/07/testowanie-polaczen-sieciowych/</link>
					<comments>/2024/10/07/testowanie-polaczen-sieciowych/#respond</comments>
		
		<dc:creator><![CDATA[Gilbert]]></dc:creator>
		<pubDate>Mon, 07 Oct 2024 20:00:35 +0000</pubDate>
				<category><![CDATA[blog]]></category>
		<guid isPermaLink="false">/?p=77</guid>

					<description><![CDATA[CzÄ™sto przed wdroÅ¼eniem produkcyjnym aplikacji potrzebujemy upewniÄ‡ siÄ™, Å¼e mamy wytrasowane wszystkie poÅ‚Ä…czenia sieciowe zgodnie z wymaganiami. W wiÄ™kszych firmach polityki na firewallu aplikowane sÄ… przez inne zespoÅ‚y i aby uniknÄ…Ä‡ niepotrzebnego stresu, opÃ³ÅºnieÅ„ czy nawet awarii lepiej upewniÄ‡ siÄ™ przed finalnym deploymentem czy aby na pewno ruch jest przepuszczony tak jak powinien. Nie ma [&#8230;]]]></description>
										<content:encoded><![CDATA[
<p>CzÄ™sto przed wdroÅ¼eniem produkcyjnym aplikacji potrzebujemy upewniÄ‡ siÄ™, Å¼e mamy wytrasowane wszystkie poÅ‚Ä…czenia sieciowe zgodnie z wymaganiami. <br><br>W wiÄ™kszych firmach polityki na firewallu aplikowane sÄ… przez inne zespoÅ‚y i aby uniknÄ…Ä‡ niepotrzebnego stresu, opÃ³ÅºnieÅ„ czy nawet awarii lepiej upewniÄ‡ siÄ™ przed finalnym deploymentem czy aby na pewno ruch jest przepuszczony tak jak powinien. <br><br>Nie ma w tym raczej nic trudnego gdy mamy juÅ¼ dziaÅ‚ajÄ…cÄ… usÅ‚ugÄ™ z wystawionymi portami do ktÃ³rej chcemy siÄ™ poÅ‚Ä…czyÄ‡&#8230; <br>co natomiast jeÅ›li potrzebujemy sprawdziÄ‡ reguÅ‚y na firewallu jeszcze przed wdroÅ¼eniem? np. gdy przygotowujemy siÄ™ kilka tygodni na jednÄ… konkretnÄ… noc?<br><br>PokaÅ¼Ä™ dzisiaj kilka ciekawych praktyk, ktÃ³re z pewnoÅ›ciÄ… przydadzÄ… Wam siÄ™ w przyszÅ‚oÅ›ci <img src="https://s.w.org/images/core/emoji/15.0.3/72x72/1f642.png" alt="ğŸ™‚" class="wp-smiley" style="height: 1em; max-height: 1em;" /></p>



<p><br><br>Gdy jest juÅ¼ wystawiony port ktÃ³ry chcemy sprawdziÄ‡ zwykle wykorzystujemy do tego starego, poczciwego <strong>telneta</strong>:</p>



<pre class="wp-block-code"><code class=""><span style="color: #b2b2b2;">[root@client~]#</span> <span style="background-color: initial; font-family: inherit; font-size: inherit;">telnet server.local 443</span></code></pre>



<p>ale to tylko jeden ze sposobÃ³w, jako alternatywÄ™ moÅ¼emy uÅ¼yÄ‡ <strong>netcata</strong>:</p>



<pre class="wp-block-code"><code class=""><span style="color: #b2b2b2;">[root@client~]#</span> n<span style="background-color: initial; font-family: inherit; font-size: inherit;">c -zv -w3 server.local 443</span></code></pre>



<p style="font-size:1rem"><em>wytÅ‚umaczenie parametrÃ³w i wiÄ™cej moÅ¼liwoÅ›ci moÅ¼ecie znaleÅºÄ‡ tutaj &#8211; <a href="https://linux.die.net/man/1/nc">https://linux.die.net/man/1/nc</a><br></em></p>



<p>szczerze mÃ³wiÄ…c jest to opcja do ktÃ³rej najczÄ™Å›ciej siÄ™gam, najwiÄ™ksza przewaga jest taka, Å¼e w parametrze &#8222;-w&#8221; moÅ¼emy podaÄ‡ iloÅ›Ä‡ sekund po ktÃ³rych dostaniemy timeout. <br>RÃ³wnieÅ¼ w przypadku pomyÅ›lnego skanu od razu dostajemy odpowiedÅº (bez czekania na input do przesÅ‚ania). DziÄ™ki temu moÅ¼emy Å‚atwo i przyjemnie wykorzystywaÄ‡ nc w swoich skryptach.<br><br>zajawka:</p>



<pre class="wp-block-code"><code class=""><span style="color: #b2b2b2;">[root@client~]#</span> f<span style="background-color: initial; font-family: inherit; font-size: inherit;">or port in {80..82}; do nc -zv -w3 wp.pl ${port} &amp;> /dev/null &amp;&amp; echo "${port}/tcp - sukces" || echo "${port}/tcp - timeout"; done</span>

<code>80/tcp - sukces
81/tcp - timeout</code><span style="background-color: initial; font-family: inherit; font-size: inherit;">82/tcp - timeout</span>


<span style="color: #b2b2b2;">[root@client~]#</span> for node in {01..10}; do nc -zv -w3 azure-www-${node}.local 443 &amp;> /dev/null &amp;&amp; echo "--443/tcp--> azure-www-${node}.local - sukces" || echo "--443/tcp--> azure-www-${node}.local - timeout"; done

--443/tcp--> azure-www-01.local - sukces
--443/tcp--> azure-www-02.local - timeout
--443/tcp--> azure-www-03.local - sukces
--443/tcp--> azure-www-04.local - timeout
--443/tcp--> azure-www-05.local - sukces
--443/tcp--> azure-www-06.local - timeout
--443/tcp--> azure-www-07.local - sukces
--443/tcp--> azure-www-08.local - timeout
--443/tcp--> azure-www-09.local - sukces
--443/tcp--> azure-www-10.local - timeout</code></pre>



<p><br></p>



<p>maÅ‚o kto wie, ale w przypadku gdy debugujemy np. <strong>kontenery </strong>i nie mamy dostÄ™pu do pobrania pakietÃ³w moÅ¼emy do przetestowania poÅ‚Ä…czenia wykorzystaÄ‡ CURLa, ktÃ³ry czÄ™sto jest preinstalowany w obrazie <img src="https://s.w.org/images/core/emoji/15.0.3/72x72/1f642.png" alt="ğŸ™‚" class="wp-smiley" style="height: 1em; max-height: 1em;" /> <strong>(ping to bardzo sÅ‚aby sposÃ³b na testowanie poÅ‚Ä…czenia)<br></strong><br>jeÅ¼eli zaleÅ¼y nam na poÅ‚Ä…czeniu HTTP/HTTPS moÅ¼emy po prostu sprawdziÄ‡:</p>



<pre class="wp-block-code"><code class=""><span style="color: #b2b2b2;">[root@client~]#</span> <span style="background-color: initial; font-family: inherit; font-size: inherit;">curl server.local:443</span></code></pre>



<p>lub jeÅ¼eli chcemy sprawdziÄ‡ dowolny port TCP moÅ¼emy uÅ¼yÄ‡:</p>



<pre class="wp-block-code"><code class=""><span style="color: #b2b2b2;">[root@client~]#</span> <span style="background-color: initial; font-family: inherit; font-size: inherit;">curl -v telnet://server.local:9200</span></code></pre>



<p><br><br>co natomiast gdy nie mamy jeszcze otwartego portu a chcemy sprawdziÄ‡ czy firewall wewnÄ™trzny/zewnÄ™trzny przepuÅ›ci nas na drugi serwer <img src="https://s.w.org/images/core/emoji/15.0.3/72x72/1f914.png" alt="ğŸ¤”" class="wp-smiley" style="height: 1em; max-height: 1em;" />? <strong>moÅ¼emy tymczasowo otworzyÄ‡ taki port</strong> <img src="https://s.w.org/images/core/emoji/15.0.3/72x72/1f60e.png" alt="ğŸ˜" class="wp-smiley" style="height: 1em; max-height: 1em;" /> uÅ¼ywajÄ…c wczeÅ›niej wspomnianego netcata &#8211; sÅ‚uÅ¼y do tego polecenie:</p>



<pre class="wp-block-code"><code class=""><span style="color: #b2b2b2;">[root@server~]#</span> <span style="background-color: initial; font-family: inherit; font-size: inherit;">nc -l -p 8080</span></code></pre>



<p>w ten sposÃ³b otwieramy port i rozpoczynamy na nim nasÅ‚uchiwanie <br>(pamiÄ™taj, Å¼e porty &lt; 1024 sÄ… uprzywilejowane i nie otworzymy ich bez podniesienia uprawnieÅ„)<br><br>na drugim serwerze moÅ¼emy sprÃ³bowaÄ‡ nawiÄ…zaÄ‡ poÅ‚Ä…czenie, a nawet przesÅ‚aÄ‡ dane</p>



<pre class="wp-block-code"><code class=""><span style="color: #b2b2b2;">[root@client~]#</span> <span style="background-color: initial; font-family: inherit; font-size: inherit;">telnet 127.0.0.1 8080</span>
<code>Trying 127.0.0.1â€¦
Connected to 127.0.0.1.
Escape character is '^]'.
testor inwestor :)</code></code></pre>



<p><br>co tak jest widoczne na serwerze z otwartym portem</p>



<pre class="wp-block-code"><code class=""><span style="color: #b2b2b2;">[root@server~]#</span> <span style="background-color: initial; font-family: inherit; font-size: inherit;">nc -l -p 8080</span>
testor inwestor :)</code></pre>



<p>(tym sposobem moÅ¼emy zrobiÄ‡ <a href="https://www.acunetix.com/blog/web-security-zone/what-is-reverse-shell/" data-type="link" data-id="https://www.acunetix.com/blog/web-security-zone/what-is-reverse-shell/">reverse shell</a> ;))</p>



<p><br></p>



<div class="wp-block-media-text is-stacked-on-mobile" style="grid-template-columns:42% auto"><figure class="wp-block-media-text__media"><a href="https://www.redshirtjeff.com/shop/p/it-was-dns-shirt"><img fetchpriority="high" decoding="async" width="800" height="800" src="/wp-content/uploads/2024/10/image.png" alt="" class="wp-image-143 size-full" srcset="/wp-content/uploads/2024/10/image.png 800w, /wp-content/uploads/2024/10/image-300x300.png 300w, /wp-content/uploads/2024/10/image-150x150.png 150w, /wp-content/uploads/2024/10/image-768x768.png 768w" sizes="(max-width: 800px) 100vw, 800px" /></a></figure><div class="wp-block-media-text__content">
<p><strong>DNS </strong>&#8211; w przypadku problemÃ³w sieciowych nauczony doÅ›wiadczeniem polecam sprawdziÄ‡ na jakie adresy rozwiÄ…zuje siÄ™ dany endpoint do ktÃ³rego prÃ³bujemy siÄ™ poÅ‚Ä…czyÄ‡.<br><br>przeszkodÄ… moÅ¼e byÄ‡ zostawienie starego adresu IP w rekordzie A, przez co losowy &#8222;strzaÅ‚&#8221; do endpointu koÅ„czy siÄ™ timeoutem <img src="https://s.w.org/images/core/emoji/15.0.3/72x72/1f62b.png" alt="ğŸ˜«" class="wp-smiley" style="height: 1em; max-height: 1em;" /><br><br>gdy korzystamy z load balancerÃ³w schowanych na przykÅ‚ad za GTM od F5 (wiÄ™cej info <a href="https://www.thenetworkdna.com/2024/01/f5-load-balancers-gtm-vs-ltm.html" data-type="link" data-id="https://www.thenetworkdna.com/2024/01/f5-load-balancers-gtm-vs-ltm.html">tutaj</a>) musimy pamiÄ™taÄ‡ o wytrasowaniu siÄ™ do wszystkich adresÃ³w IP loadbalancerÃ³w, ktÃ³re GTM moÅ¼e nam zaserwowaÄ‡, w przeciwnym wypadku wykorzystujÄ…c balansowanie round-robin co drugi request bÄ™dzie siÄ™ timeoutowaÅ‚ (a w przypadku global availability przestanie nam dziaÅ‚aÄ‡ poÅ‚Ä…czenie po przepiÄ™ciu siÄ™ do drugiej serwerowni <img src="https://s.w.org/images/core/emoji/15.0.3/72x72/1f642.png" alt="ğŸ™‚" class="wp-smiley" style="height: 1em; max-height: 1em;" />)</p>
</div></div>



<p><br><br><strong>na sam koniec zostawiÅ‚em narzÄ™dzia ktÃ³re czÄ™sto pomogÅ‚y mi znaleÅºÄ‡ przyczynÄ™ gdy nie miaÅ‚em juÅ¼ Å¼adnych pomysÅ‚Ã³w<br></strong>mam na myÅ›li<strong> lsof, strace i tcpdump<br></strong><br>polecenie <strong>lsof </strong>standardowo pokazuje otwarte pliki (co teÅ¼ jest przydatne, ale nie w tym wpisie)<br>natomiast z przeÅ‚Ä…cznikiem -i wyÅ›wietla listÄ™ nawiÄ…zanych w danym momencie poÅ‚Ä…czeÅ„ sieciowych na serwerze</p>



<pre class="wp-block-code"><code class=""><span style="color: #b2b2b2;">[root@server~]#</span> lsof -i
...
dnf       26754   root   24u  IPv4 181335      0t0  TCP serwer.local:59472->proxy14.fedoraproject.org:https (ESTABLISHED)
...</code></pre>



<p>w ten sposÃ³b moÅ¼emy zobaczyÄ‡ kto aktualnie jest podÅ‚Ä…czony do serwera np. po http/https/ssh/&#8230;<br>do jakich adresÃ³w serwer nawiÄ…zuje poÅ‚Ä…czenie (np. przy pobieraniu pakietÃ³w)<br><br><br>narzÄ™dzie <strong>strace </strong>&#8211; pozwala na wyÅ›wietlenie wywoÅ‚aÅ„ systemowych (baardzo przydatne polecenie, natomiast jego wynik naleÅ¼y traktowaÄ‡ bardziej jako ÅºrÃ³dÅ‚o do grepowania, niÅ¼ do czytania w caÅ‚oÅ›ci)<br><br>dodajÄ…c do niego parametr &#8222;-e&#8221; moÅ¼emy podpiÄ…Ä‡ siÄ™ pod konkretne wywoÅ‚anie systemowe (w tym przypadku bÄ™dziemy korzystaÄ‡ z connect) <br>flaga &#8222;-f&#8221; oznacza natomiast, Å¼e chcemy podpinaÄ‡ siÄ™ pod forki procesu</p>



<pre class="wp-block-code"><code class=""><span style="color: #b2b2b2;">[root@client~]#</span> strace -e connect mysql -h serwer.local
...
connect(3, {sa_family=AF_INET, sin_port=htons(53), sin_addr=inet_addr("8.8.8.8")}, 16) = 0
connect(3, {sa_family=AF_INET, sin_port=htons(3306), sin_addr=inet_addr("192.168.0.11")}, 16) = 0
connect(3, {sa_family=AF_INET, sin_port=htons(3306), sin_addr=inet_addr("10.11.0.1")}, 16) = 0
REFUSED (Connection refused)
connect(3, {sa_family=AF_INET, sin_port=htons(3306), sin_addr=inet_addr("192.168.0.11")}, 16) = 0
ERROR 1045 (28000): Access denied for user 'root'@'192.168.0.11' (using password: NO)
</code></pre>



<p>moÅ¼emy podpiÄ…Ä‡ siÄ™ stracem pod komende lub wywoÅ‚aÄ‡ binarkÄ™ i przeÅ›wietliÄ‡ do jakich konkretnie adresÃ³w IP &#8222;uderza&#8221; aplikacja.</p>



<p>komanda o szerokim zastosowaniu, jednym z nich moÅ¼e byÄ‡ okreÅ›lenie do jakiego adresu IP klastra bazy danych Å‚Ä…czy siÄ™ binarka (gdy przykÅ‚adowo wykorzystujemy MSSQL i MultiSubnetFailover=True).<br><br><br>ostatnie narzÄ™dzie w tym wpisie o ktÃ³rym chciaÅ‚bym powiedzieÄ‡/przypomnieÄ‡ to <strong>tcpdump</strong>. <br>choÄ‡ pewnie wiÄ™kszoÅ›ci bardzo dobrze znane, nie mogÅ‚o go tutaj zabraknÄ…Ä‡.<br><br>sÅ‚uÅ¼y do odpalenia nasÅ‚uchiwania na karcie sieciowej i pozwala zrzucaÄ‡ pakiety do pliku w celu ich pÃ³Åºniejszej analizy.<br>NajwiÄ™kszÄ… zaletÄ… tego narzÄ™dzia jest surowy wynik, ktÃ³ry moÅ¼emy odpaliÄ‡ w WireSharku i w czytelniejszej formie filtrowaÄ‡, analizowaÄ‡ niskopoziomowe pakiety. &#8222;SurÃ³wka&#8221; daje nam teÅ¼ moÅ¼liwoÅ›Ä‡ przesÅ‚ania zebranej komunikacji sieciowej do sieciowcÃ³w w celu gÅ‚Ä™bszej analizy.</p>
]]></content:encoded>
					
					<wfw:commentRss>/2024/10/07/testowanie-polaczen-sieciowych/feed/</wfw:commentRss>
			<slash:comments>0</slash:comments>
		
		
			</item>
	</channel>
</rss>
